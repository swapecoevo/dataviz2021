---
title: "Herbivory Diversity Field Exp"
author: "Swapna Subramanian"
date: "July 29, 2019"
output:
  pdf_document: default
  word_document: default
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##load packages
```{r}
library(ggplot2)
library(ggbeeswarm)
library(cowplot)
library(ggpubr)
library(dplyr)
library(bbmle)
library(nortest)
library(MASS)
library(nlme)
```

##load data
```{r}
fieldherbdat<- read.csv(file = "Field Herb Raw Data_v4.csv")

```

##urban eco data analysis a little bit
```{r,include=FALSE}
#test for normality, lol super not normal
hist(final.noSN$wetwt)
ad.test(final.noSN$wetwt)
shapiro.test(final.noSN$wetwt)

hist(final.noSN$drywt)
shapiro.test(final.noSN$drywt)

#log transform and sqrt transform the data to try and make it more normal
final.noSN$wetwt.log <- log(final.noSN$wetwt + 0.5)
hist(final.noSN$wetwt.log)
shapiro.test(final.noSN$wetwt.log)

final.noSN$wetwt.sqrt <- sqrt(final.noSN$wetwt)
hist(final.noSN$wetwt.sqrt)
shapiro.test(final.noSN$wetwt.sqrt)

final.noSN$drywt.log <- log(final.noSN$drywt + 0.005)
hist(final.noSN$drywt.log)
shapiro.test(final.noSN$drywt.log)

final.noSN$drywt.sqrt <- sqrt(final.noSN$drywt)
hist(final.noSN$drywt.sqrt)
shapiro.test(final.noSN$drywt.sqrt)

#t test dry weight v inclusion exclusion
t.test(drywt~herb, data = finalherbinex)

aggregate(finalherbinex$drywt, by=list(finalherbinex$herb), sd)

ggplot(data=finalherbinex, aes(x=herb, y=drywt, fill = herb)) +
  geom_bar(stat = "identity") 

summary(quine)
head(quine)

#chisquare test
quine.table <- table(quine$Eth, quine$Lrn)
prop.table(quine.table)
chisq.test(quine.table)

#regression of drywt v wetwt
reg <-lm(drywt~wetwt, data = finalherbinex)
summary(reg)

#multiple regression
mulreg <- lm(drywt~site+herb, data = finalherbinex)
summary(mulreg)

ggboxplot(data = finalherbinex,
          x = "herb",
           y = "drywt",
           xlab = "Herbivore Treatment",
           ylab = "Duckweed Dry Weight",
           facet.by = "site",
          fill = "herb",
          add = c("loess")) +
  scale_color_brewer(palette = "Dark2") +
  scale_fill_brewer(palette = "Dark2")




```

##reorder so ex is first, then in, then aph and wee
```{r}
fieldherbdat$herb <- factor(fieldherbdat$herb, levels = c('EX', 'IN', 'WEE', 'APH'), ordered = TRUE)

fieldherbdat$num <- as.character(fieldherbdat$num)
fieldherbdat$num <- as.numeric(fieldherbdat$num)
```

##splitting up by site and other things
```{r}
#final day data
finalherbdat<- fieldherbdat%>% filter(day== "21" | day== "22" | day== "23" | day== "24")

#final day data by location
finalSN <- finalherbdat %>% filter(site == "Shelter Nine")
finalSF <- finalherbdat %>% filter(site == "Spillway Far")
finalSC <- finalherbdat %>% filter(site == "Spillway Close")
finalSB <- finalherbdat %>% filter(site == "Stuart's Bay")

#final day data without SN
final.noSN <- finalherbdat %>% filter(site != "Shelter Nine")

#final day data only inclusion and exclusion without SN
final.inex <- final.noSN %>% filter(herb == "IN" | herb == "EX")

#final day data only herbivory treatments
finalherbherbs <- final.noSN %>% filter(herb != "EX")

#final day data by location without exclusion
finalSN.herbs <- finalSN %>% filter(herb != "EX")
finalSF.herbs <- finalSF %>% filter(herb != "EX")
finalSC.herbs <- finalSC %>% filter(herb != "EX")
finalSB.herbs <- finalSB %>% filter(herb != "EX")

finalSF.in <- finalSF %>% filter(herb == "IN")
finalSF.ex <- finalSF %>% filter(herb == "EX")
t.test(finalSF.in$drywt, finalSF.ex$drywt)

#final day Spillway Close data without shaded site
finalSC.light <- finalSC %>% filter(rep != "3")

#by species
final.sp <- final.noSN %>% filter(spp.dw == "SP")
final.lm <- final.noSN %>% filter(spp.dw == "LM")

```

##quick graphs :)
```{r}
#wet weight
ggboxplot(data = finalherbdat,
          x = "herb",
           y = "wetwt",
           xlab = "Herbivore Treatment",
           ylab = "Duckweed Wet Weight",
           fill = "spp.dw",
           shape = "spp.dw",
           facet.by = "site",
          add = c("loess")) +
  scale_color_brewer(palette = "Dark2") +
  scale_fill_brewer(palette = "Dark2")

#dry weight
ggboxplot(data = finalherbdat,
          x = "herb",
           y = "drywt",
           xlab = "Herbivore Treatment",
           ylab = "Duckweed Dry Weight",
           fill = "spp.dw",
           shape = "spp.dw",
           facet.by = "site",
          add = c("loess")) +
  scale_color_brewer(palette = "Dark2") +
  scale_fill_brewer(palette = "Dark2")

summary(finalherbdat$spp.dw)

#dry weight
ggerrorplot(data = finalherbdat,
          x = "herb",
           y = "drywt",
          desc_stat = "mean_se",
          merge = TRUE,
           xlab = "Herbivore Treatment",
           ylab = "Duckweed Dry Weight (g)",
           color = "spp.dw",
          fill = "herb",
           facet.by = "site",
          palette = "Set1")

#reorder so spillway close and stuart's bay are next to each other
final.noSN$site <- factor(final.noSN$site, levels = c('Spillway Far', 'Spillway Close', 'Stuarts Bay', ordered = TRUE))

#abundance
ggerrorplot(data = final.noSN,
          x = "herb",
           y = "num.std",
          desc_stat = "mean_se",
          merge = TRUE,
           xlab = "Herbivore Treatment",
           ylab = "Duckweed Relative Growth Rate",
           color = "spp.dw",
          fill = "herb",
           facet.by = "site",
          palette = "Set1")

#species together
ggboxplot(data = finalherbdat,
          x = "herb",
           y = "drywt",
           xlab = "Herbivore Treatment",
           ylab = "Duckweed Dry Weight",
          fill = "herb",
           facet.by = "site",
          add = c("loess")) +
  scale_color_brewer(palette = "Spectral") +
  scale_fill_brewer(palette = "Spectral")

##sites separately
#shelter nine
ggboxplot(data = finalSN,
          x = "herb",
           y = "drywt",
           xlab = "Herbivore Treatment",
           ylab = "Duckweed Dry Weight",
           fill = "spp.dw",
           shape = "spp.dw",
           facet.by = "site",
          add = c("loess")) +
  scale_color_brewer(palette = "Dark2") +
  scale_fill_brewer(palette = "Dark2")

ggerrorplot(data = finalSN,
          x = "herb",
           y = "drywt",
          desc_stat = "mean_se",
          merge = TRUE,
           xlab = "Herbivore Treatment",
           ylab = "Duckweed Dry Weight",
           color = "spp.dw",
          fill = "herb",
          palette = "Budapest")

#spillway close
ggboxplot(data = finalSC,
          x = "herb",
           y = "drywt",
           xlab = "Herbivore Treatment",
           ylab = "Duckweed Dry Weight",
           fill = "spp.dw",
           shape = "spp.dw",
           facet.by = "site",
          add = c("loess")) +
  scale_color_brewer(palette = "Dark2") +
  scale_fill_brewer(palette = "Dark2")

ggerrorplot(data = finalSC,
          x = "herb",
           y = "drywt",
           xlab = "Herbivore Treatment",
           ylab = "Duckweed Dry Weight",
           color = "spp.dw",
          fill = "herb",
          palette = "Budapest")

#spillway far
ggboxplot(data = finalSF,
          x = "herb",
           y = "drywt",
           xlab = "Herbivore Treatment",
           ylab = "Duckweed Dry Weight",
           fill = "spp.dw",
           shape = "spp.dw",
           facet.by = "site",
          add = c("loess")) +
  scale_color_brewer(palette = "Dark2") +
  scale_fill_brewer(palette = "Dark2")

#stuart's bay
ggboxplot(data = finalSB,
          x = "herb",
           y = "drywt",
           xlab = "Herbivore Treatment",
           ylab = "Duckweed Dry Weight",
           fill = "spp.dw",
           shape = "spp.dw",
           facet.by = "site",
          add = c("loess")) +
  scale_color_brewer(palette = "Dark2") +
  scale_fill_brewer(palette = "Dark2")


```

##anova w/ herb, spp.dw, and site
```{r}
##dry weight
final.site.dry.herb.spp.dw <- aov(drywt ~ site + herb + spp.dw, data = finalherbdat)
final.site.dry.herb.spp.dw.in <- aov(drywt ~ site * herb * spp.dw, data = finalherbdat)
final.site.dry.herb <- aov(drywt ~ site + herb, data = finalherbdat)
final.site.dry.herb.in <- aov(drywt ~ site * herb, data = finalherbdat)
final.site.dry.spp.dw <- aov(drywt ~site + spp.dw, data = finalherbdat)
final.site.dry.spp.dw.in <- aov(drywt ~site * spp.dw, data = finalherbdat)
final.site.dry <- aov(drywt ~ site, data = finalherbdat)
final.dry.none <- aov(drywt ~ 1, data = finalherbdat)

AICtab(final.site.dry,final.site.dry.herb,final.site.dry.herb.in,final.site.dry.herb.spp.dw,final.site.dry.herb.spp.dw.in, final.site.dry.spp.dw, final.site.dry.spp.dw.in,final.dry.none)
summary(final.site.dry.herb.in)

##abundance
final.site.num.herb.spp.dw <- aov(num ~ site + herb + spp.dw, data = finalherbdat)
final.site.num.herb.spp.dw.in <- aov(num ~ site * herb * spp.dw, data = finalherbdat)
final.site.num.herb <- aov(num ~ site + herb, data = finalherbdat)
final.site.num.herb.in <- aov(num ~ site * herb, data = finalherbdat)
final.site.num.spp.dw <- aov(num ~site + spp.dw, data = finalherbdat)
final.site.num.spp.dw.in <- aov(num ~site * spp.dw, data = finalherbdat)
final.site.num <- aov(num ~ site, data = finalherbdat)
final.num.none <- aov(num ~ 1, data = finalherbdat)

AICtab(final.site.num,final.site.num.herb,final.site.num.herb.in,final.site.num.herb.spp.dw,final.site.num.herb.spp.dw.in, final.site.num.spp.dw, final.site.num.spp.dw.in,final.num.none)
summary(final.site.num.herb.spp.dw.in)
```

##same as above but without the confounding Shelter Nine
```{r}
##dry weight
final.noSN.dry.nosite.herb.spp.dw <- aov(drywt ~ herb + spp.dw, data = final.noSN)
final.noSN.dry.herb.spp.dw <- aov(drywt ~ site + herb + spp.dw, data = final.noSN)
final.noSN.dry.herb.spp.dw.in <- aov(drywt ~ site * herb * spp.dw, data = final.noSN)
final.noSN.dry.herb <- aov(drywt ~ site + herb, data = final.noSN)
final.noSN.dry.herb.in <- aov(drywt ~ site * herb, data = final.noSN)
final.noSN.dry.spp.dw <- aov(drywt ~site + spp.dw, data = final.noSN)
final.noSN.dry.spp.dw.in <- aov(drywt ~site * spp.dw, data = final.noSN)
final.noSN.dry <- aov(drywt ~ site, data = final.noSN)
final.dry.none <- aov(drywt ~ 1, data = final.noSN)

AICtab(final.noSN.dry,final.noSN.dry.herb,final.noSN.dry.herb.in,final.noSN.dry.herb.spp.dw,final.noSN.dry.herb.spp.dw.in, final.noSN.dry.spp.dw, final.noSN.dry.spp.dw.in,final.dry.none, final.noSN.dry.nosite.herb.spp.dw)
summary(final.noSN.dry.herb.spp.dw.in)
TukeyHSD(final.noSN.dry.herb.spp.dw)

##abundance
final.noSN.num.nosite.herb.spp.dw <- aov(num ~ herb + spp.dw, data = final.noSN)
final.noSN.num.herb.spp.dw <- aov(num ~ site + herb + spp.dw, data = final.noSN)
final.noSN.num.herb.spp.dw.in <- aov(num ~ site * herb * spp.dw, data = final.noSN)
final.noSN.num.herb <- aov(num ~ site + herb, data = final.noSN)
final.noSN.num.herb.in <- aov(num ~ site * herb, data = final.noSN)
final.noSN.num.spp.dw <- aov(num ~site + spp.dw, data = final.noSN)
final.noSN.num.spp.dw.in <- aov(num ~site * spp.dw, data = final.noSN)
final.noSN.num <- aov(num ~ site, data = final.noSN)
final.num.none <- aov(num ~ 1, data = final.noSN)

AICtab(final.noSN.num,final.noSN.num.herb,final.noSN.num.herb.in,final.noSN.num.herb.spp.dw,final.noSN.num.herb.spp.dw.in, final.noSN.num.spp.dw, final.noSN.num.spp.dw.in,final.num.none, final.noSN.num.nosite.herb.spp.dw)
summary(final.noSN.num.herb.spp.dw.in)
TukeyHSD(final.noSN.num.herb.spp.dw.in)

##standardized abundacne (relative growth rate)
final.noSN.num.std.nosite.herb.spp.dw <- aov(num.std ~ herb + spp.dw, data = final.noSN)
final.noSN.num.std.herb.spp.dw <- aov(num.std ~ site + herb + spp.dw, data = final.noSN)
final.noSN.num.std.herb.spp.dw.in <- aov(num.std ~ site * herb * spp.dw, data = final.noSN)
final.noSN.num.std.herb <- aov(num.std ~ site + herb, data = final.noSN)
final.noSN.num.std.herb.in <- aov(num.std ~ site * herb, data = final.noSN)
final.noSN.num.std.spp.dw <- aov(num.std ~site + spp.dw, data = final.noSN)
final.noSN.num.std.spp.dw.in <- aov(num.std ~site * spp.dw, data = final.noSN)
final.noSN.num.std <- aov(num.std ~ site, data = final.noSN)
final.num.std.none <- aov(num.std ~ 1, data = final.noSN)

AICtab(final.noSN.num.std,final.noSN.num.std.herb,final.noSN.num.std.herb.in,final.noSN.num.std.herb.spp.dw,final.noSN.num.std.herb.spp.dw.in, final.noSN.num.std.spp.dw, final.noSN.num.std.spp.dw.in,final.num.std.none, final.noSN.num.std.nosite.herb.spp.dw)
summary(final.noSN.num.std.herb.spp.dw.in)
TukeyHSD(final.noSN.num.std.herb.spp.dw.in)

```

##abudnance std between only herbivory treatments
```{r}
##standardized abundacne (relative growth rate)
finalherbherbs.num.std.nosite.herb.spp.dw <- aov(num.std ~ herb + spp.dw, data = finalherbherbs)
finalherbherbs.num.std.herb.spp.dw <- aov(num.std ~ site + herb + spp.dw, data = finalherbherbs)
finalherbherbs.num.std.herb.spp.dw.in <- aov(num.std ~ site * herb * spp.dw, data = finalherbherbs)
finalherbherbs.num.std.herb <- aov(num.std ~ site + herb, data = finalherbherbs)
finalherbherbs.num.std.herb.in <- aov(num.std ~ site * herb, data = finalherbherbs)
finalherbherbs.num.std.spp.dw <- aov(num.std ~site + spp.dw, data = finalherbherbs)
finalherbherbs.num.std.spp.dw.in <- aov(num.std ~site * spp.dw, data = finalherbherbs)
finalherbherbs.num.std <- aov(num.std ~ site, data = finalherbherbs)
final.num.std.none <- aov(num.std ~ 1, data = finalherbherbs)

AICtab(finalherbherbs.num.std,finalherbherbs.num.std.herb,finalherbherbs.num.std.herb.in,finalherbherbs.num.std.herb.spp.dw,finalherbherbs.num.std.herb.spp.dw.in, finalherbherbs.num.std.spp.dw, finalherbherbs.num.std.spp.dw.in,final.num.std.none, finalherbherbs.num.std.nosite.herb.spp.dw)
summary(finalherbherbs.num.std.herb.spp.dw.in)
TukeyHSD(finalherbherbs.num.std.herb.spp.dw.in)
```

##abundance standardized between species and glm because its counts
```{r}
##well lets do the anova first
final.noSN.num.std.nosite.herb.spp.dw <- aov(num.std ~ herb + spp.dw, data = final.noSN)
final.noSN.num.std.herb.spp.dw <- aov(num.std ~ site + herb + spp.dw, data = final.noSN)
final.noSN.num.std.herb.spp.dw.in <- aov(num.std ~ site * herb * spp.dw, data = final.noSN)
final.noSN.num.std.herb <- aov(num.std ~ site + herb, data = final.noSN)
final.noSN.num.std.herb.in <- aov(num.std ~ site * herb, data = final.noSN)
final.noSN.num.std.spp.dw <- aov(num.std ~site + spp.dw, data = final.noSN)
final.noSN.num.std.spp.dw.in <- aov(num.std ~site * spp.dw, data = final.noSN)
final.noSN.num.std <- aov(num.std ~ site, data = final.noSN)
final.num.std.none <- aov(num.std ~ 1, data = final.noSN)

AICtab(final.noSN.num.std,final.noSN.num.std.herb,final.noSN.num.std.herb.in,final.noSN.num.std.herb.spp.dw,final.noSN.num.std.herb.spp.dw.in, final.noSN.num.std.spp.dw, final.noSN.num.std.spp.dw.in,final.num.std.none, final.noSN.num.std.nosite.herb.spp.dw)
summary(final.noSN.num.herb.spp.dw.in)
TukeyHSD(final.noSN.num.std.herb.spp.dw.in)

#ok now glm
final.glm.num.std.nosite.herb.spp.dw <- glm(num.std ~ herb + spp.dw, data = final.noSN)
final.glm.num.std.herb.spp.dw <- glm(num.std ~ site + herb + spp.dw, data = final.noSN)
final.glm.num.std.herb.spp.dw.in <- glm(num.std ~ site * herb * spp.dw, data = final.noSN)
final.glm.num.std.herb <- glm(num.std ~ site + herb, data = final.noSN)
final.glm.num.std.herb.in <- glm(num.std ~ site * herb, data = final.noSN)
final.glm.num.std.spp.dw <- glm(num.std ~site + spp.dw, data = final.noSN)
final.glm.num.std.spp.dw.in <- glm(num.std ~site * spp.dw, data = final.noSN)
final.glm.num.std <- glm(num.std ~ site, data = final.noSN)
final.num.std.none <- glm(num.std ~ 1, data = final.noSN)

AICtab(final.glm.num.std,final.glm.num.std.herb,final.glm.num.std.herb.in,final.glm.num.std.herb.spp.dw,final.glm.num.std.herb.spp.dw.in, final.glm.num.std.spp.dw, final.glm.num.std.spp.dw.in,final.num.std.none, final.glm.num.std.nosite.herb.spp.dw)
summary(final.glm.num.std.herb.spp.dw.in)
TukeyHSD(final.glm.num.std.herb.spp.dw.in)
```



##same as above just in and ex treatments
```{r}
##dry weight
final.inex.dry.nosite.herb.spp.dw <- aov(drywt ~ herb + spp.dw, data = final.inex)
final.inex.dry.herb.spp.dw <- aov(drywt ~ site + herb + spp.dw, data = final.inex)
final.inex.dry.herb.spp.dw.in <- aov(drywt ~ site * herb * spp.dw, data = final.inex)
final.inex.dry.herb <- aov(drywt ~ site + herb, data = final.inex)
final.inex.dry.herb.in <- aov(drywt ~ site * herb, data = final.inex)
final.inex.dry.spp.dw <- aov(drywt ~site + spp.dw, data = final.inex)
final.inex.dry.spp.dw.in <- aov(drywt ~site * spp.dw, data = final.inex)
final.inex.dry <- aov(drywt ~ site, data = final.inex)
final.dry.none <- aov(drywt ~ 1, data = final.inex)

AICtab(final.inex.dry,final.inex.dry.herb,final.inex.dry.herb.in,final.inex.dry.herb.spp.dw,final.inex.dry.herb.spp.dw.in, final.inex.dry.spp.dw, final.inex.dry.spp.dw.in,final.dry.none, final.inex.dry.nosite.herb.spp.dw)
summary(final.inex.dry.herb.spp.dw.in)
TukeyHSD(final.inex.dry.herb.spp.dw)

##abundance
final.inex.num.nosite.herb.spp.dw <- aov(num ~ herb + spp.dw, data = final.inex)
final.inex.num.herb.spp.dw <- aov(num ~ site + herb + spp.dw, data = final.inex)
final.inex.num.herb.spp.dw.in <- aov(num ~ site * herb * spp.dw, data = final.inex)
final.inex.num.herb <- aov(num ~ site + herb, data = final.inex)
final.inex.num.herb.in <- aov(num ~ site * herb, data = final.inex)
final.inex.num.spp.dw <- aov(num ~site + spp.dw, data = final.inex)
final.inex.num.spp.dw.in <- aov(num ~site * spp.dw, data = final.inex)
final.inex.num <- aov(num ~ site, data = final.inex)
final.num.none <- aov(num ~ 1, data = final.inex)

AICtab(final.inex.num,final.inex.num.herb,final.inex.num.herb.in,final.inex.num.herb.spp.dw,final.inex.num.herb.spp.dw.in, final.inex.num.spp.dw, final.inex.num.spp.dw.in,final.num.none, final.inex.num.nosite.herb.spp.dw)
summary(final.inex.num.herb.spp.dw.in)
TukeyHSD(final.inex.num.herb.spp.dw.in)

##with standardized abundance values
final.inex.num.std.nosite.herb.spp.dw <- aov(num.std ~ herb + spp.dw, data = final.inex)
final.inex.num.std.herb.spp.dw <- aov(num.std ~ site + herb + spp.dw, data = final.inex)
final.inex.num.std.herb.spp.dw.in <- aov(num.std ~ site * herb * spp.dw, data = final.inex)
final.inex.num.std.herb <- aov(num.std ~ site + herb, data = final.inex)
final.inex.num.std.herb.in <- aov(num.std ~ site * herb, data = final.inex)
final.inex.num.std.spp.dw <- aov(num.std ~site + spp.dw, data = final.inex)
final.inex.num.std.spp.dw.in <- aov(num.std ~site * spp.dw, data = final.inex)
final.inex.num.std <- aov(num.std ~ site, data = final.inex)
final.num.std.none <- aov(num.std ~ 1, data = final.inex)

AICtab(final.inex.num.std,final.inex.num.std.herb,final.inex.num.std.herb.in,final.inex.num.std.herb.spp.dw,final.inex.num.std.herb.spp.dw.in, final.inex.num.std.spp.dw, final.inex.num.std.spp.dw.in,final.num.std.none, final.inex.num.std.nosite.herb.spp.dw)
summary(final.inex.num.std.herb.spp.dw.in)
TukeyHSD(final.inex.num.std.herb.spp.dw.in)

```


##some quick anova modeling of all of the dry weights by site
```{r}
#just a quick anova model fit to shelter nine
final.SN.dry.herb.spp.dw.in <- aov(drywt ~ herb* spp.dw, data = finalSN)

final.SN.dry.herb.spp.dw <- aov(drywt ~ herb+ spp.dw, data = finalSN)

final.SN.dry.spp.dw <- aov(drywt ~ spp.dw, data = finalSN)

final.SN.dry.herb <- aov(drywt ~ herb, data = finalSN)

final.SN.dry.none <- aov(drywt~ 1, data = finalSN)

anova(final.SN.dry.herb, final.SN.dry.herb.spp.dw, final.SN.dry.spp.dw, final.SN.dry.none, final.SN.dry.herb.spp.dw.in)
AICtab(final.SN.dry.herb, final.SN.dry.herb.spp.dw, final.SN.dry.spp.dw, final.SN.dry.none, final.SN.dry.herb.spp.dw.in)

#stuart's bay- herbivore treatment and species duckweed matter and are lowkey interacting
final.SB.dry.herb.spp.dw <- aov(drywt ~ herb+ spp.dw, data = finalSB)

final.SB.dry.herb.spp.dw.in <- aov(drywt ~ herb* spp.dw, data = finalSB)

final.SB.dry.spp.dw <- aov(drywt ~ spp.dw, data = finalSB)

final.SB.dry.herb <- aov(drywt ~ herb, data = finalSB)

final.SB.dry.none <- aov(drywt~ 1, data = finalSB)

anova(final.SB.dry.herb, final.SB.dry.herb.spp.dw, final.SB.dry.spp.dw, final.SB.dry.none)
AICtab(final.SB.dry.herb, final.SB.dry.herb.spp.dw, final.SB.dry.spp.dw, final.SB.dry.none,final.SB.dry.herb.spp.dw.in)
summary(final.SB.dry.herb.spp.dw.in)
TukeyHSD(final.SB.dry.herb.spp.dw)

#spillway close -- only species duckweed matters
final.SC.dry.herb.spp.dw <- aov(drywt ~ herb + spp.dw, data = finalSC)

final.SC.dry.herb.spp.dw.in <- aov(drywt ~ herb* spp.dw, data = finalSC)

final.SC.dry.spp.dw <- aov(drywt ~ spp.dw, data = finalSC)

final.SC.dry.herb <- aov(drywt ~ herb, data = finalSC)

final.SC.dry.none <- aov(drywt~ 1, data = finalSC)

anova(final.SC.dry.herb, final.SC.dry.herb.spp.dw, final.SC.dry.spp.dw, final.SC.dry.none)
AICtab(final.SC.dry.herb, final.SC.dry.herb.spp.dw, final.SC.dry.spp.dw, final.SC.dry.none, final.SC.dry.herb.spp.dw.in)
summary(final.SC.dry.spp.dw)

#spillway far -- only herbivore treatment
final.SF.dry.herb.spp.dw <- aov(drywt ~ herb+ spp.dw, data = finalSF)

final.SF.dry.herb.spp.dw.in <- aov(drywt ~ herb* spp.dw, data = finalSF)

final.SF.dry.spp.dw <- aov(drywt ~ spp.dw, data = finalSF)

final.SF.dry.herb <- aov(drywt ~ herb, data = finalSF)

final.SF.dry.none <- aov(drywt~ 1, data = finalSF)

anova(final.SF.dry.herb, final.SF.dry.herb.spp.dw, final.SF.dry.spp.dw, final.SF.dry.none)
AICtab(final.SF.dry.herb, final.SF.dry.herb.spp.dw, final.SF.dry.spp.dw, final.SF.dry.none, final.SF.dry.herb.spp.dw.in)
summary(final.SF.dry.herb)
summary(final.SF.dry.herb.spp.dw.in)
TukeyHSD(final.SF.dry.herb)
TukeyHSD(final.SF.dry.herb.spp.dw.in)

```

##spillway close modeling
```{r}
#with shaded rep
final.SC.dry.herb.spp.dw <- aov(drywt ~ herb + spp.dw, data = finalSC)

final.SC.dry.herb.spp.dw.in <- aov(drywt ~ herb* spp.dw, data = finalSC)

final.SC.dry.spp.dw <- aov(drywt ~ spp.dw, data = finalSC)

final.SC.dry.herb <- aov(drywt ~ herb, data = finalSC)

final.SC.dry.none <- aov(drywt~ 1, data = finalSC)

anova(final.SC.dry.herb, final.SC.dry.herb.spp.dw, final.SC.dry.spp.dw, final.SC.dry.none)
AICtab(final.SC.dry.herb, final.SC.dry.herb.spp.dw, final.SC.dry.spp.dw, final.SC.dry.none, final.SC.dry.herb.spp.dw.in)
summary(final.SC.dry.spp.dw)

#without shaded rep
final.SC.dry.herb.spp.dw <- aov(drywt ~ herb + spp.dw, data = finalSC.light)

final.SC.dry.herb.spp.dw.in <- aov(drywt ~ herb* spp.dw, data = finalSC.light)

final.SC.dry.spp.dw <- aov(drywt ~ spp.dw, data = finalSC.light)

final.SC.dry.herb <- aov(drywt ~ herb, data = finalSC.light)

final.SC.dry.none <- aov(drywt~ 1, data = finalSC.light)

anova(final.SC.dry.herb, final.SC.dry.herb.spp.dw, final.SC.dry.spp.dw, final.SC.dry.none)
AICtab(final.SC.dry.herb, final.SC.dry.herb.spp.dw, final.SC.dry.spp.dw, final.SC.dry.none, final.SC.dry.herb.spp.dw.in)
summary(final.SC.dry.herb.spp.dw) # interesting now herbivore treatment also matters but they don't interact

##abundance babey
#with shaded rep
final.SC.num.std.herb.spp.dw <- aov(num.std ~ herb + spp.dw, data = finalSC)

final.SC.num.std.herb.spp.dw.in <- aov(num.std ~ herb* spp.dw, data = finalSC)

final.SC.num.std.spp.dw <- aov(num.std ~ spp.dw, data = finalSC)

final.SC.num.std.herb <- aov(num.std ~ herb, data = finalSC)

final.SC.num.std.none <- aov(num.std~ 1, data = finalSC)

anova(final.SC.num.std.herb, final.SC.num.std.herb.spp.dw, final.SC.num.std.spp.dw, final.SC.num.std.none)
AICtab(final.SC.num.std.herb, final.SC.num.std.herb.spp.dw, final.SC.num.std.spp.dw, final.SC.num.std.none, final.SC.num.std.herb.spp.dw.in)
summary(final.SC.num.std.herb.spp.dw)

#without shaded rep
final.SC.num.herb.spp.dw <- aov(num ~ herb + spp.dw, data = finalSC.light)

final.SC.num.herb.spp.dw.in <- aov(num ~ herb* spp.dw, data = finalSC.light)

final.SC.num.spp.dw <- aov(num ~ spp.dw, data = finalSC.light)

final.SC.num.herb <- aov(num ~ herb, data = finalSC.light)

final.SC.num.none <- aov(num~ 1, data = finalSC.light)

anova(final.SC.num.herb, final.SC.num.herb.spp.dw, final.SC.num.spp.dw, final.SC.num.none)
AICtab(final.SC.num.herb, final.SC.num.herb.spp.dw, final.SC.num.spp.dw, final.SC.num.none, final.SC.num.herb.spp.dw.in)
summary(final.SC.num.herb.spp.dw.in)
TukeyHSD(final.SC.num.herb.spp.dw.in)
```

##spillway far modeling
```{r}
final.SF.dry.herb.spp.dw <- aov(drywt ~ herb+ spp.dw, data = finalSF)

final.SF.dry.herb.spp.dw.in <- aov(drywt ~ herb* spp.dw, data = finalSF)

final.SF.dry.spp.dw <- aov(drywt ~ spp.dw, data = finalSF)

final.SF.dry.herb <- aov(drywt ~ herb, data = finalSF)

final.SF.dry.none <- aov(drywt~ 1, data = finalSF)

anova(final.SF.dry.herb, final.SF.dry.herb.spp.dw, final.SF.dry.spp.dw, final.SF.dry.none)
AICtab(final.SF.dry.herb, final.SF.dry.herb.spp.dw, final.SF.dry.spp.dw, final.SF.dry.none, final.SF.dry.herb.spp.dw.in)
summary(final.SF.dry.herb)
summary(final.SF.dry.herb.spp.dw.in)
TukeyHSD(final.SF.dry.herb)
TukeyHSD(final.SF.dry.herb.spp.dw.in)


##abundance babey
final.SF.num.std.herb.spp.dw <- aov(num.std ~ herb + spp.dw, data = finalSF)

final.SF.num.std.herb.spp.dw.in <- aov(num.std ~ herb* spp.dw, data = finalSF)

final.SF.num.std.spp.dw <- aov(num.std ~ spp.dw, data = finalSF)

final.SF.num.std.herb <- aov(num.std ~ herb, data = finalSF)

final.SF.num.std.none <- aov(num.std~ 1, data = finalSF)

anova(final.SF.num.std.herb, final.SF.num.std.herb.spp.dw, final.SF.num.std.spp.dw, final.SF.num.std.none)
AICtab(final.SF.num.std.herb, final.SF.num.std.herb.spp.dw, final.SF.num.std.spp.dw, final.SF.num.std.none, final.SF.num.std.herb.spp.dw.in)
summary(final.SF.num.std.herb.spp.dw.in)
TukeyHSD(final.SF.num.std.herb.spp.dw.in)
```

##stuart's bay modeling
```{r}
#dry weight
final.SB.dry.herb.spp.dw <- aov(drywt ~ herb+ spp.dw, data = finalSB)

final.SB.dry.herb.spp.dw.in <- aov(drywt ~ herb* spp.dw, data = finalSB)

final.SB.dry.spp.dw <- aov(drywt ~ spp.dw, data = finalSB)

final.SB.dry.herb <- aov(drywt ~ herb, data = finalSB)

final.SB.dry.none <- aov(drywt~ 1, data = finalSB)

anova(final.SB.dry.herb, final.SB.dry.herb.spp.dw, final.SB.dry.spp.dw, final.SB.dry.none)
AICtab(final.SB.dry.herb, final.SB.dry.herb.spp.dw, final.SB.dry.spp.dw, final.SB.dry.none,final.SB.dry.herb.spp.dw.in)
summary(final.SB.dry.herb.spp.dw.in)
TukeyHSD(final.SB.dry.herb.spp.dw)

#abundance 
final.SB.num.herb.spp.dw <- aov(num ~ herb+ spp.dw, data = finalSB)

final.SB.num.herb.spp.dw.in <- aov(num ~ herb* spp.dw, data = finalSB)

final.SB.num.spp.dw <- aov(num ~ spp.dw, data = finalSB)

final.SB.num.herb <- aov(num ~ herb, data = finalSB)

final.SB.num.none <- aov(num~ 1, data = finalSB)

anova(final.SB.num.herb, final.SB.num.herb.spp.dw, final.SB.num.spp.dw, final.SB.num.none)
AICtab(final.SB.num.herb, final.SB.num.herb.spp.dw, final.SB.num.spp.dw, final.SB.num.none,final.SB.num.herb.spp.dw.in)
summary(final.SB.num.herb.spp.dw)
TukeyHSD(final.SB.num.herb.spp.dw)
```

##some quick anova modeling of all of the dry weights by site without exclosures
```{r}
#shelter nine
finalSN.herbs.herbs.dry.herb.spp.dw.in <- aov(drywt ~ herb* spp.dw, data = finalSN.herbs)
finalSN.herbs.herbs.dry.herb.spp.dw <- aov(drywt ~ herb+ spp.dw, data = finalSN.herbs)
finalSN.herbs.herbs.dry.spp.dw <- aov(drywt ~ spp.dw, data = finalSN.herbs)
finalSN.herbs.herbs.dry.herb <- aov(drywt ~ herb, data = finalSN.herbs)
finalSN.herbs.herbs.dry.none <- aov(drywt~ 1, data = finalSN.herbs)

anova(finalSN.herbs.herbs.dry.herb, finalSN.herbs.herbs.dry.herb.spp.dw, finalSN.herbs.herbs.dry.spp.dw, finalSN.herbs.herbs.dry.none, finalSN.herbs.herbs.dry.herb.spp.dw.in)
AICtab(finalSN.herbs.herbs.dry.herb, finalSN.herbs.herbs.dry.herb.spp.dw, finalSN.herbs.herbs.dry.spp.dw, finalSN.herbs.herbs.dry.none, finalSN.herbs.herbs.dry.herb.spp.dw.in)

#stuart's bay
finalSB.herbs.dry.herb.spp.dw <- aov(drywt ~ herb+ spp.dw, data = finalSB.herbs)
finalSB.herbs.dry.herb.spp.dw.in <- aov(drywt ~ herb* spp.dw, data = finalSB.herbs)
finalSB.herbs.dry.spp.dw <- aov(drywt ~ spp.dw, data = finalSB.herbs)
finalSB.herbs.dry.herb <- aov(drywt ~ herb, data = finalSB.herbs)
finalSB.herbs.dry.none <- aov(drywt~ 1, data = finalSB.herbs)

anova(finalSB.herbs.dry.herb, finalSB.herbs.dry.herb.spp.dw, finalSB.herbs.dry.spp.dw, finalSB.herbs.dry.none)
AICtab(finalSB.herbs.dry.herb, finalSB.herbs.dry.herb.spp.dw, finalSB.herbs.dry.spp.dw, finalSB.herbs.dry.none,finalSB.herbs.dry.herb.spp.dw.in)
summary(finalSB.herbs.dry.herb.spp.dw.in)
TukeyHSD(finalSB.herbs.dry.herb.spp.dw.in)

#spillway close
finalSC.herbs.herbs.dry.herb.spp.dw <- aov(drywt ~ herb + spp.dw, data = finalSC.herbs)
finalSC.herbs.herbs.dry.herb.spp.dw.in <- aov(drywt ~ herb* spp.dw, data = finalSC.herbs)
finalSC.herbs.herbs.dry.spp.dw <- aov(drywt ~ spp.dw, data = finalSC.herbs)
finalSC.herbs.herbs.dry.herb <- aov(drywt ~ herb, data = finalSC.herbs)
finalSC.herbs.herbs.dry.none <- aov(drywt~ 1, data = finalSC.herbs)

anova(finalSC.herbs.herbs.dry.herb, finalSC.herbs.herbs.dry.herb.spp.dw, finalSC.herbs.herbs.dry.spp.dw, finalSC.herbs.herbs.dry.none)
AICtab(finalSC.herbs.herbs.dry.herb, finalSC.herbs.herbs.dry.herb.spp.dw, finalSC.herbs.herbs.dry.spp.dw, finalSC.herbs.herbs.dry.none, finalSC.herbs.herbs.dry.herb.spp.dw.in)
summary(finalSC.herbs.herbs.dry.spp.dw)

#spillway far
finalSF.herbs.dry.herb.spp.dw <- aov(drywt ~ herb+ spp.dw, data = finalSF.herbs)
finalSF.herbs.dry.herb.spp.dw.in <- aov(drywt ~ herb* spp.dw, data = finalSF.herbs)
finalSF.herbs.dry.spp.dw <- aov(drywt ~ spp.dw, data = finalSF.herbs)
finalSF.herbs.dry.herb <- aov(drywt ~ herb, data = finalSF.herbs)
finalSF.herbs.dry.none <- aov(drywt~ 1, data = finalSF.herbs)

anova(finalSF.herbs.dry.herb, finalSF.herbs.dry.herb.spp.dw, finalSF.herbs.dry.spp.dw, finalSF.herbs.dry.none)
AICtab(finalSF.herbs.dry.herb, finalSF.herbs.dry.herb.spp.dw, finalSF.herbs.dry.spp.dw, finalSF.herbs.dry.none, finalSF.herbs.dry.herb.spp.dw.in)
summary(finalSF.herbs.dry.herb)
TukeyHSD(finalSF.herbs.dry.herb)
```

##maybe lets do percent difference of final and initial proportion of lm to sp 
```{r}
#calculate and make new column
##dry weight
finalherbdat.sp$drywt.prop <- finalherbdat.lm$drywt/finalherbdat.sp$drywt
#difference from initial
finalherbdat.sp$drywt.prop.diff <- (finalherbdat.sp$drywt.prop - (90/60))/(90/60)
###WAIT I ACTUALLY CAN'T DO THIS LOL IGNORE THIS- UNLESS I GET THIS DATA

##abundance
finalherbdat.sp$num.prop <- finalherbdat.lm$num/finalherbdat.sp$num
finalherbdat.sp$num.prop.diff <- (finalherbdat.sp$num.prop - (90/60))/(90/60)

#graphs
#dry weight
ggerrorplot(data = finalherbdat.sp,
          x = "herb",
           y = "drywt.prop",
          desc_stat = "mean_se",
          merge = TRUE,
           xlab = "Herbivore Treatment",
           ylab = "Duckweed Dry Weight (g)",
          fill = "herb",
           facet.by = "site",
          palette = "Set1")

#abundance
ggerrorplot(data = finalherbdat.sp,
          x = "herb",
           y = "num.prop.diff",
          desc_stat = "mean_se",
          merge = TRUE,
           xlab = "Herbivore Treatment",
           ylab = "Percent Difference in Proportion of Duckweed Species Abundance",
          color = "herb",
           facet.by = "site",
          palette = "Set1")

#quick stats
final.herbdat.prop.herb <- aov(num.prop.diff ~ herb, data = finalherbdat.sp)

final.herbdat.prop.none <- aov(num.prop.diff~ 1, data = finalherbdat.sp)

anova(final.herbdat.prop.herb, final.herbdat.prop.none)
AICtab(final.herbdat.prop.herb, final.herbdat.prop.none)
summary(final.herbdat.prop.herb)
```

------------------------------------------------------------------------------------------------
##here begins analysis with time series and surface area, data that was previously unavailable but has now been procured by spending my last summer counting duckweed

##load data
```{r}
datafull<- read.csv(file = "Field Herb Raw Data_v2.csv")
```

##reorder herbivore treatments and make day a factor
```{r}
datafull$herb <- factor(datafull$herb, levels = c('EX', 'IN', 'WEE', 'APH'), ordered = TRUE)

datafull$day <- as.character(datafull$day)
datafull$day <- as.factor(datafull$day)
class(datafull$day)
```

##split data
```{r}
#just week 2
data.w2 <- datafull %>% filter(day == "7")

data <- datafull %>% filter(site != "Shelter Nine")

data <- data %>% filter(day != "13")
```

##some preliminary graphs
```{r}
#abundance by date and species
ggline(data = data,
          x = "day",
           y = "num",
          desc_stat = "mean_se",
          merge = TRUE,
           xlab = "Herbivore Treatment",
           ylab = "Duckweed Relative Growth Rate",
           color = "spp.dw",
          fill = "herb",
           facet.by = "site",
          palette = "Set1")

#abundance by herbivore treatment and species and day??
ggboxplot(data = data,
          x = "herb",
           y = "num.std",
          desc_stat = "mean_se",
          merge = TRUE,
           xlab = "Herbivore Treatment",
           ylab = "Duckweed Relative Growth Rate",
           color = "day",
          fill = "spp.dw",
           facet.by = "site",
          palette = "Set1")

#area by herbivore treatment and species and day
#abundance by herbivore treatment and species and day??
ggboxplot(data = data,
          x = "herb",
           y = "area",
          desc_stat = "mean_se",
          merge = TRUE,
           xlab = "Herbivore Treatment",
           ylab = "Duckweed Surface Area",
           color = "day",
          fill = "spp.dw",
           facet.by = "site",
          palette = "Set1")

#abundance by date and herbivore treatment
ggerrorplot(data = data,
          x = "day",
           y = "num",
          desc_stat = "mean_se",
          merge = TRUE,
           xlab = "Herbivore Treatment",
           ylab = "Duckweed Relative Growth Rate",
           color = "herb",
          fill = "herb",
           facet.by = "site",
          palette = "Set1")

#abundance by date and herbivore treatment and sppdw
ggboxplot(data = data,
          x = "day",
           y = "num",
          desc_stat = "mean_se",
          merge = TRUE,
           xlab = "Herbivore Treatment",
           ylab = "Duckweed Relative Growth Rate",
           color = "herb",
          fill = "spp.dw",
           facet.by = "site",
          palette = "Set1")
```

##non linear mixed model- using standardized abundances
```{r}
##exponential vs log growth
expo <- nlme(num.std ~ 1*exp(r*day),
              fixed = r~site*herb*spp.dw, #species dw, herbivore treatment, and site as interacting fixed effects
              random = r ~ 1|box.code, #each individual box is related as repeated measure
              data = data,
              correlation=corAR1(form=~1|box.code),
              start=c(r=c(0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05)))
summary(aphexpo)

length(coef(lm(num.std ~ site*herb*spp.dw, data = data.noSN))) #determining how long that damn start value should be

class(data$box.code)

aphlog <- nlme(aph.ct ~ (K/(1+(K/5 - 1)*exp(-r*day))),
                        fixed = K+r~spp.dw,#species dw as fixed effect
                      random = K+r ~ 1|jar.code, #each individual jar is related as repeated measure 
                      data = aphdat,
                      correlation=corAR1(form=~1|jar.code),
                      start=c(K=c(205,330,100),r=c(0.2,0.1,0.2)),
                     weights= varExp(form= ~day|spp.dw), # Variance-covariance function that differs between both densities
                      verbose=T, control=c(maxIter=100)) 
summary(aphlog)
```

